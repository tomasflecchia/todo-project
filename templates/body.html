<div class="container">
    <!-- Top bar with list controls -->
    <div class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
        <form method="POST" class="list-form d-flex flex-column flex-md-row align-items-stretch align-items-md-center gap-2">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="list_id" value="{{ todo_list.id }}">
            <input type="text" name="list_name" class="list_name form-control"
                   placeholder="My to-do list" value="{{ todo_list.title }}">

            <div class="dropdown">
                <button class="btn list_btn btn-outline-primary dropdown-toggle"
                        type="button" id="listsDropdown" data-bs-toggle="dropdown"
                        aria-expanded="false">
                    Select List
                </button>
                <ul class="dropdown-menu" aria-labelledby="listsDropdown">
                    {% for l in all_lists %}
                        <li>
                            <a class="dropdown-item {% if l.id == todo_list.id %}active{% endif %}"
                               href="{{ url_for('index', list_id=l.id) }}">
                                {{ l.title }}
                            </a>
                        </li>
                    {% else %}
                        <li><span class="dropdown-item text-muted">No lists yet</span></li>
                    {% endfor %}
                </ul>
            </div>

            <button formaction="{{ url_for('delete_list') }}"
                    class="btn list_btn btn-danger white_text"
                    type="submit">
                Delete This List
            </button>

            <button formaction="{{ url_for('save_list') }}"
                    class="btn list_btn btn-secondary white_text"
                    type="submit">
                Save This List
            </button>

            {% if current_user.is_authenticated %}
                <a href="{{ url_for('new_list') }}"
                   class="btn list_btn btn-warning white_text d-flex align-items-center justify-content-center">
                    New List
                </a>
            {% else %}
                <button type="button" class="btn list_btn btn-warning white_text"
                        data-bs-toggle="modal" data-bs-target="#popupFormModal">
                    New List
                </button>
            {% endif %}
        </form>
    </div>

    <!-- Task input form -->
    <div class="my-4">
        <form method="POST" action="{{ url_for('submit_task') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="list_id" value="{{ todo_list.id }}">
            <div class="input-group input-group-lg">
                <input type="text" name="task" class="form-control" placeholder="Type your task here...">
                <button class="btn btn-primary" type="submit">Add</button>
            </div>
        </form>
    </div>

    <!-- Task list -->
    <div class="todo-list mt-2">
        <ul class="list-group">
            {% for task in todo_list.tasks %}
                <li class="list-group-item d-flex justify-content-between align-items-center {% if task.is_done %}task-done{% endif %}">
                    <form method="POST" action="{{ url_for('edit_task', task_id=task.id) }}"
                          class="d-flex flex-grow-1 gap-2 align-items-center">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <input type="checkbox" name="is_done" value="1"
                               {% if task.is_done %}checked{% endif %}
                               style="width:24px;height:24px;">
                        <input type="text" name="title" value="{{ task.title }}" class="form-control">
                        <input type="date" name="date" value="{{ task.date or '' }}"
                               class="form-control hide-on-small" style="max-width: 160px;">

                        <!-- Save button -->
                        <button class="btn btn-sm btn-success d-none d-md-inline-flex" type="submit">
                            Save
                        </button>
                        <button class="btn btn-sm btn-success d-inline-flex d-md-none" type="submit">
                            <i class="bi bi-check-lg"></i>
                        </button>
                    </form>

                    <!-- Delete button -->
                    <div class="btn-group ms-2">
                        <form method="POST" action="{{ url_for('delete_task', task_id=task.id) }}">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button class="btn btn-sm btn-danger d-none d-md-inline-flex" type="submit">
                                Delete
                            </button>
                            <button class="btn btn-sm btn-danger d-inline-flex d-md-none" type="submit">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
                    </div>
                </li>
            {% else %}
                <li class="list-group-item text-muted">No tasks yet</li>
            {% endfor %}
        </ul>
    </div>
</div>

